# Litho Server 项目规范

> 本文档作为 LLM 辅助开发的入口索引，详细规范已拆分为独立的 skill 文件。

## 项目概述

基于 Go 的后端服务项目，使用以下核心技术栈：

- **Web 框架**：Hertz (CloudWeGo)
- **ORM**：GORM
- **数据库**：PostgreSQL
- **缓存**：Redis
- **依赖注入**：Wire (github.com/goforj/wire)
- **数据库迁移**：Atlas

## Skills 索引

根据用户需求，参考对应的 skill 文件获取详细规范：

| Skill | 文件 | 触发场景 |
|-------|------|----------|
| GORM 模型生成 | [skills/gorm-model.md](skills/gorm-model.md) | 创建/修改数据库模型、表结构 |
| 数据库迁移 | [skills/db-migrate.md](skills/db-migrate.md) | 执行迁移、同步表结构、迁移问题 |
| API 模块 | [skills/api-module.md](skills/api-module.md) | 创建 API 接口、新增模块、路由 |

## 快速参考

### 项目结构

```
server/
├── api/                 # API 模块
│   ├── api.go           # 路由聚合
│   ├── auth.go          # 认证中间件
│   └── {module}/        # 各业务模块
├── cmd/
│   └── atlas-loader/    # Atlas 迁移加载器
├── common/              # 公共组件
├── model/               # GORM 模型
├── migrations/          # 迁移文件
└── scripts/
    └── migrate.py       # 迁移脚本
```

### 常用命令

```bash
# 迁移
scripts/migrate.py diff     # 生成迁移
scripts/migrate.py apply    # 应用迁移
scripts/migrate.py status   # 查看状态

# Go
go mod tidy                 # 整理依赖
go generate ./...           # Wire 生成
go run .                    # 运行
go test ./...               # 测试
```

### 核心约定

1. **主键**：使用 `string` 类型 + `type:bigint`（避免 JS 精度丢失）
2. **时间字段**：必须使用 `type:timestamptz`
3. **依赖注入**：使用 `wire.NewSet` + `wire.Struct(new(Type), "*")`
4. **错误处理**：统一使用 `c.Error(err)`
5. **响应格式**：无数据返回 `help.Ok()`，有数据直接返回

### 新增功能流程

1. **创建模型** → 参考 `gorm-model` skill
2. **注册模型** → 在 `cmd/atlas-loader/main.go`
3. **执行迁移** → 参考 `db-migrate` skill
4. **创建 API** → 参考 `api-module` skill
5. **注册路由** → 在 `api/api.go`
